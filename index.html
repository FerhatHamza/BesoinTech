<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BesoinTech - Gestion des Besoins</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Cairo', 'sans-serif'] },
                    colors: {
                        primary: '#2563eb', // Blue 600
                        secondary: '#475569', // Slate 600
                    }
                }
            }
        }
    </script>
    <style>
        /* Smooth transitions */
        .page { transition: opacity 0.3s ease-in-out; }
        .hidden-page { display: none; opacity: 0; }
        
        /* Custom Scrollbar for the list */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        /* Input Focus Ring Animation */
        input:focus { transition: all 0.2s; }

        /* RTL Specific adjustments handled by dir="rtl" natively by flexbox */
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen antialiased">

    <script>
        const API_URL = "https://besointech.ferhathamza17.workers.dev"; 
    </script>

    <div id="login-page" class="min-h-screen w-full flex items-center justify-center p-4 bg-gradient-to-br from-blue-600 to-indigo-900">
        <div class="bg-white/95 backdrop-blur rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all hover:scale-[1.01] duration-300">
            <div class="bg-blue-600 h-2"></div>
            
            <div class="p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 tracking-tight">BesoinTech</h1>
                    <p class="text-gray-500 text-sm mt-1">Platforme de Recensement</p>
                    <p class="text-gray-400 text-xs mt-1">ŸÖŸÜÿµÿ© ÿ•ÿ≠ÿµÿßÿ° ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™</p>
                </div>
                
                <form id="login-form" class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-gray-600 uppercase mb-1 ml-1">Username / ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
                        <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-gray-50 focus:bg-white" placeholder="admin" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-600 uppercase mb-1 ml-1">Password / ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±</label>
                        <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition bg-gray-50 focus:bg-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg hover:shadow-xl transition transform active:scale-95 flex justify-center items-center gap-2">
                        <span>Login</span>
                        <span>/</span>
                        <span>ÿØÿÆŸàŸÑ</span>
                    </button>
                    <p id="login-error" class="text-red-500 text-center text-sm hidden bg-red-50 p-2 rounded border border-red-100 animate-pulse">
                        üö´ Access Denied
                    </p>
                </form>
            </div>
        </div>
    </div>

    <div id="app-page" class="hidden-page min-h-screen flex flex-col bg-gray-50">
        <header class="bg-white shadow-md p-4 sticky top-0 z-50 backdrop-blur-md bg-white/90">
            <div class="container mx-auto max-w-4xl flex justify-between items-center">
                <div class="flex flex-col">
                    <h2 class="font-bold text-xl text-blue-800 leading-tight">BesoinTech</h2>
                    <span id="user-display" class="text-[10px] md:text-xs text-gray-500 font-medium bg-gray-100 px-2 py-0.5 rounded-full w-fit"></span>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleLang()" class="text-xs font-bold border border-gray-300 px-3 py-2 rounded-lg hover:bg-gray-100 transition">üåê AR/FR</button>
                    <button onclick="logout()" class="text-xs font-bold bg-red-50 text-red-600 border border-red-100 px-3 py-2 rounded-lg hover:bg-red-100 transition">Logout</button>
                </div>
            </div>
        </header>

        <div class="container mx-auto p-4 max-w-4xl flex-grow pb-24">
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r shadow-sm">
                <div class="flex items-start">
                    <div class="text-2xl mr-3">‚ö†Ô∏è</div>
                    <div>
                        <p class="text-sm text-yellow-800 font-bold uppercase tracking-wide" data-translate="warning_title">IMPORTANT</p>
                        <p class="text-sm text-yellow-700 mt-1 leading-relaxed" data-translate="warning_text">
                            Do not count old or broken equipment. Only request NEW needs.
                        </p>
                    </div>
                </div>
            </div>

            <form id="needs-form">
                <div id="products-list" class="grid grid-cols-1 gap-4">
                    <div class="text-center py-10 text-gray-400">Loading products...</div>
                </div>

                <div class="mt-8 bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg mb-4 text-gray-700 flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 p-1 rounded">‚ûï</span>
                        <span data-translate="other_title">Autre / ÿ£ÿÆÿ±Ÿâ</span>
                    </h3>
                    <div id="custom-items-container" class="space-y-3"></div>
                    <button type="button" onclick="addCustomItem()" class="mt-4 w-full py-2 border-2 border-dashed border-gray-300 text-gray-500 rounded-lg hover:border-blue-400 hover:text-blue-500 transition text-sm font-bold">
                        + <span data-translate="add_other">Ajouter un autre article</span>
                    </button>
                </div>

                <div class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur border-t p-4 z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                    <div class="container mx-auto max-w-4xl">
                        <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white text-lg font-bold py-3 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2">
                            <span>‚úÖ</span>
                            <span data-translate="submit_btn">Envoyer la demande / ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="admin-page" class="hidden-page min-h-screen bg-gray-100">
        <header class="bg-slate-800 text-white p-4 shadow-lg sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <h2 class="font-bold text-lg md:text-xl">Admin Dashboard</h2>
                <button onclick="logout()" class="text-xs bg-slate-700 border border-slate-600 px-3 py-1 rounded hover:bg-slate-600 transition">Logout</button>
            </div>
        </header>

        <div class="container mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 class="font-bold text-gray-700 mb-4 pb-2 border-b">Add New Product</h3>
                <form id="admin-add-product" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" name="name_fr" placeholder="Nom (Fran√ßais)" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none" required>
                        <input type="text" name="name_ar" placeholder="ÿßŸÑÿßÿ≥ŸÖ (ÿπÿ±ÿ®Ÿä)" class="w-full border p-2 rounded focus:ring-2 focus:ring-blue-500 outline-none text-right" required>
                    </div>
                    <select name="category" class="w-full border p-2 rounded bg-white">
                        <option value="hardware">Mat√©riel Info</option>
                        <option value="peripheral">P√©riph√©riques</option>
                        <option value="furniture">Mobilier</option>
                    </select>
                    <div class="flex items-center gap-3 bg-gray-50 p-3 rounded border">
                        <input type="checkbox" name="requires_detail" id="req_det" class="w-5 h-5 text-blue-600">
                        <label for="req_det" class="text-sm text-gray-700 cursor-pointer">
                            Requires "Where does it go?"<br>
                            <span class="text-xs text-gray-400">(Check this for PC, Printers...)</span>
                        </label>
                    </div>
                    <button type="submit" class="w-full bg-slate-800 text-white font-bold py-2 rounded hover:bg-slate-900 transition">Add Product</button>
                </form>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col justify-center items-center text-center">
                <h3 class="text-gray-500 text-sm font-bold uppercase tracking-widest">Total Requests</h3>
                <p id="total-requests-count" class="text-6xl font-bold text-blue-600 my-4">0</p>
                <div class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">Live Data from Cloudflare D1</div>
            </div>
        </div>

        <div class="container mx-auto p-4 lg:p-6">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <h3 class="p-4 font-bold bg-gray-50 border-b text-gray-700">Incoming Requests</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm whitespace-nowrap">
                        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                            <tr>
                                <th class="p-4">ID</th>
                                <th class="p-4">Service / Chef</th>
                                <th class="p-4">Total Items</th>
                                <th class="p-4">Date</th>
                                <th class="p-4">Action</th>
                            </tr>
                        </thead>
                        <tbody id="requests-table-body" class="divide-y divide-gray-100">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- TRANSLATIONS ---
        const LANG = {
            fr: {
                warning_title: "IMPORTANT",
                warning_text: "Ne comptez pas le mat√©riel ancien ou en panne. Indiquez uniquement les nouveaux besoins.",
                other_title: "Autre / Divers",
                add_other: "Ajouter un autre article",
                submit_btn: "Envoyer la demande",
                lbl_qty: "Quantit√©",
                lbl_note: "Remarque (Optionnel)",
                lbl_alloc: "Emplacement (Bureau n¬∞, Etage...)"
            },
            ar: {
                warning_title: "ÿ™ŸÜÿ®ŸäŸá ŸáÿßŸÖ",
                warning_text: "ŸÑÿß ÿ™ÿ≠ÿ≥ÿ® ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑŸÇÿØŸäŸÖÿ© ÿ£Ÿà ÿßŸÑŸÖÿπÿ∑ŸÑÿ©. ŸÅŸÇÿ∑ ÿ£ÿØÿÆŸÑ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©.",
                other_title: "ÿ£ÿÆÿ±Ÿâ",
                add_other: "ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ± ÿ¢ÿÆÿ±",
                submit_btn: "ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®",
                lbl_qty: "ÿßŸÑŸÉŸÖŸäÿ©",
                lbl_note: "ŸÖŸÑÿßÿ≠ÿ∏ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)",
                lbl_alloc: "ÿßŸÑŸÖŸÉÿßŸÜ (ÿ±ŸÇŸÖ ÿßŸÑŸÖŸÉÿ™ÿ®ÿå ÿßŸÑÿ∑ÿßÿ®ŸÇ...)"
            }
        };
        let currentLang = 'fr';

        // --- AUTH & NAVIGATION ---
        const loginForm = document.getElementById('login-form');
        
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const btn = e.target.querySelector('button');
            
            // Loading State
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="animate-spin text-xl">‚Üª</span> Loading...';
            btn.disabled = true;

            try {
                const res = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username: u, password: p })
                });
                
                if (res.ok) {
                    const user = await res.json();
                    localStorage.setItem('user', JSON.stringify(user));
                    checkAuth();
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (err) {
                alert("Connection Error. Check internet or Worker URL.");
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        function checkAuth() {
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                showPage('login-page');
                return;
            }
            const user = JSON.parse(userStr);
            
            if (user.role === 'admin') {
                showPage('admin-page');
                loadAdminData();
            } else {
                showPage('app-page');
                document.getElementById('user-display').innerText = `${user.full_name} | ${user.service_name}`;
                loadProducts();
            }
        }

        function logout() {
            localStorage.removeItem('user');
            location.reload();
        }

        function showPage(id) {
            ['login-page', 'app-page', 'admin-page'].forEach(pid => {
                document.getElementById(pid).classList.add('hidden-page');
            });
            const p = document.getElementById(id);
            p.style.display = 'flex'; // Default flex for pages
            if(id === 'app-page' || id === 'admin-page') p.style.display = 'block'; // Block for content pages
            if(id === 'login-page') p.style.display = 'flex'; // Center flex for login

            setTimeout(() => p.style.opacity = '1', 50);
        }

        // --- USER APP LOGIC ---
        let allProducts = [];

        async function loadProducts() {
            try {
                const res = await fetch(`${API_URL}/api/products`);
                allProducts = await res.json();
                renderProducts();
            } catch(e) {
                document.getElementById('products-list').innerHTML = `<p class="text-red-500 text-center">Error loading products.</p>`;
            }
        }

        function renderProducts() {
            const container = document.getElementById('products-list');
            container.innerHTML = '';
            
            allProducts.forEach(p => {
                const name = currentLang === 'ar' ? p.name_ar : p.name_fr;
                const dir = currentLang === 'ar' ? 'rtl' : 'ltr';
                
                // Responsive Card: Flex-col on mobile, Flex-row on desktop
                const html = `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 transition hover:shadow-md hover:border-blue-200" dir="${dir}">
                    <div class="flex flex-col md:flex-row justify-between md:items-center gap-3">
                        
                        <div class="flex-1">
                            <h3 class="font-bold text-lg text-gray-800 leading-tight">${name}</h3>
                            <span class="inline-block mt-1 text-[10px] uppercase font-bold text-gray-400 bg-gray-50 px-2 py-0.5 rounded tracking-wider">${p.category}</span>
                        </div>

                        <div class="flex items-center justify-between md:justify-end gap-3 bg-gray-50 p-2 rounded-lg md:bg-transparent md:p-0">
                            <label class="text-sm font-bold text-gray-600 md:hidden">${LANG[currentLang].lbl_qty}</label>
                            <input type="number" min="0" placeholder="0"
                                   class="w-20 md:w-24 border border-gray-300 rounded-lg p-2 text-center text-lg font-bold text-blue-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none qty-input shadow-inner bg-white"
                                   onchange="handleQtyChange(this, ${p.id}, ${p.requires_detail})">
                        </div>
                    </div>
                    
                    <input type="text" id="note-${p.id}" placeholder="${LANG[currentLang].lbl_note}..." 
                           class="mt-3 w-full text-sm py-2 px-1 border-b border-gray-200 focus:border-blue-400 outline-none bg-transparent transition-colors">

                    <div id="alloc-${p.id}" class="mt-4 hidden bg-blue-50 p-4 rounded-lg border border-blue-100 animate-fade-in">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-blue-500">üìç</span>
                            <p class="text-xs text-blue-700 font-bold uppercase">Location required / ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖŸÉÿßŸÜ ŸÖÿ∑ŸÑŸàÿ®</p>
                        </div>
                        <div class="alloc-inputs-container space-y-2"></div>
                    </div>
                </div>
                `;
                container.innerHTML += html;
            });
            updateStaticText();
        }

        window.handleQtyChange = function(input, pid, needsDetail) {
            const qty = parseInt(input.value) || 0;
            const container = document.getElementById(`alloc-${pid}`);
            const inputsDiv = container.querySelector('.alloc-inputs-container');
            
            // Highlight row if active
            const card = input.closest('.bg-white');
            if(qty > 0) card.classList.add('border-blue-400', 'ring-1', 'ring-blue-100');
            else card.classList.remove('border-blue-400', 'ring-1', 'ring-blue-100');

            if (!needsDetail) return;

            if (qty > 0) {
                container.classList.remove('hidden');
                let html = '';
                for(let i=1; i<=qty; i++) {
                    html += `
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-blue-400 w-6">#${i}</span>
                        <input type="text" name="p_${pid}_u_${i}" 
                               placeholder="${LANG[currentLang].lbl_alloc}" 
                               class="flex-1 bg-white border border-blue-200 rounded text-sm px-3 py-2 focus:outline-none focus:border-blue-500 shadow-sm">
                    </div>`;
                }
                inputsDiv.innerHTML = html;
            } else {
                container.classList.add('hidden');
                inputsDiv.innerHTML = '';
            }
        }

        window.addCustomItem = function() {
            const container = document.getElementById('custom-items-container');
            const div = document.createElement('div');
            div.className = "flex flex-col md:flex-row gap-2 items-start md:items-center bg-gray-50 p-2 rounded border border-dashed border-gray-300";
            div.innerHTML = `
                <input type="text" placeholder="Item Name / ÿßÿ≥ŸÖ ÿßŸÑŸÖÿßÿØÿ©" class="flex-1 w-full border p-2 rounded text-sm custom-name focus:outline-none focus:border-blue-400">
                <div class="flex gap-2 w-full md:w-auto">
                    <input type="number" placeholder="Qty" class="w-20 border p-2 rounded text-sm custom-qty focus:outline-none focus:border-blue-400">
                    <button type="button" onclick="this.closest('div').remove()" class="bg-red-100 text-red-500 rounded px-3 py-2 font-bold hover:bg-red-200">‚úï</button>
                </div>
            `;
            container.appendChild(div);
        }

        document.getElementById('needs-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = JSON.parse(localStorage.getItem('user'));
            const btn = e.target.querySelector('button[type="submit"]');
            
            const items = [];
            
            // 1. Standard Products
            allProducts.forEach(p => {
                // Find input by searching parent structure is safer or by unique ID if added
                // Since we rely on onchange previously, let's select via DOM safely:
                // We find the input inside the specific card context if possible, 
                // but since IDs are unique, we can iterate products and find inputs.
                
                // Let's iterate the products array and find inputs based on attribute we set
                const qtyInput = document.querySelector(`input[onchange*="${p.id},"]`);
                const qty = parseInt(qtyInput?.value) || 0;
                
                if (qty > 0) {
                    const note = document.getElementById(`note-${p.id}`).value;
                    const allocations = [];
                    
                    if (p.requires_detail) {
                        const allocInputs = document.querySelectorAll(`input[name^="p_${p.id}_u_"]`);
                        allocInputs.forEach(inp => allocations.push(inp.value));
                        
                        // Validation: Ensure allocations are filled
                        if(allocations.some(a => a.trim() === "")) {
                            alert(`Please specify location for all units of: ${p.name_fr}`);
                            throw new Error("Validation Failed"); 
                        }
                    }
                    
                    items.push({
                        name: p.name_fr,
                        quantity: qty,
                        notes: note,
                        allocations: allocations
                    });
                }
            });

            // 2. Custom Items
            document.querySelectorAll('#custom-items-container > div').forEach(div => {
                const name = div.querySelector('.custom-name').value;
                const qty = div.querySelector('.custom-qty').value;
                if(name && qty) {
                    items.push({ name: name + " (Autre)", quantity: parseInt(qty), allocations: [], notes: "Custom Item" });
                }
            });

            if(items.length === 0) return alert("Please select at least one item.");

            // Submit
            try {
                btn.disabled = true;
                btn.innerHTML = "Sending...";
                
                const res = await fetch(`${API_URL}/api/submit`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ user_id: user.id, items: items })
                });

                if(res.ok) {
                    alert("Request Submitted Successfully! / ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠");
                    location.reload();
                } else {
                    alert("Server Error");
                    btn.disabled = false;
                }
            } catch (err) {
                if(err.message !== "Validation Failed") alert("Network Error");
                btn.disabled = false;
                btn.innerHTML = '<span data-translate="submit_btn">Envoyer la demande</span>';
                updateStaticText();
            }
        });

        // --- ADMIN LOGIC ---
        async function loadAdminData() {
            try {
                const res = await fetch(`${API_URL}/api/admin/data`);
                const data = await res.json();
                
                document.getElementById('total-requests-count').innerText = data.requests.length;
                
                const tbody = document.getElementById('requests-table-body');
                if(data.requests.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-400">No requests yet.</td></tr>`;
                    return;
                }

                tbody.innerHTML = data.requests.map(r => `
                    <tr class="hover:bg-blue-50 transition border-b border-gray-100 group">
                        <td class="p-4 font-mono text-xs text-gray-500">#${r.id}</td>
                        <td class="p-4">
                            <div class="font-bold text-gray-800">${r.full_name}</div>
                            <div class="text-xs text-blue-600 bg-blue-100 inline-block px-1 rounded">${r.service_name}</div>
                        </td>
                        <td class="p-4 text-gray-700 font-bold text-lg">${r.total_items}</td>
                        <td class="p-4 text-xs text-gray-500">${new Date(r.created_at).toLocaleDateString()}</td>
                        <td class="p-4"><button class="text-blue-600 hover:underline text-xs font-bold">View</button></td>
                    </tr>
                `).join('');
            } catch(e) {
                console.error(e);
            }
        }
        
        document.getElementById('admin-add-product').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            data.requires_detail = formData.get('requires_detail') === 'on';
            
            btn.innerText = "Adding...";
            await fetch(`${API_URL}/api/admin/product`, { method: 'POST', body: JSON.stringify(data) });
            
            alert("Product Added");
            form.reset();
            btn.innerText = "Add Product";
        });

        // --- UTILS ---
        function toggleLang() {
            currentLang = currentLang === 'fr' ? 'ar' : 'fr';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            renderProducts();
        }

        function updateStaticText() {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if(LANG[currentLang][key]) el.innerHTML = LANG[currentLang][key]; // innerHTML to allow icons
            });
        }

        // Init
        checkAuth();
    </script>
</body>
</html>
